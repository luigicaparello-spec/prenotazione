<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prenotazioni ‚Äî Casa Luigi</title>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />

  <!-- Google Translate -->
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement(
        { pageLanguage: 'it', includedLanguages: 'en,fr,de,es,it' },
        'google_translate_element'
      );
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <style>
    body {
      font-family: "Poppins", Arial, sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      text-align: center;
      position: relative;
    }

    h1 {
      margin-top: 0;
      color: #2c3e50;
    }

    #calendar {
      margin-top: 20px;
    }

    .button {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 20px;
      font-size: 16px;
      color: #fff;
      background-color: #25D366;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: 0.3s;
    }

    .button:hover {
      background-color: #1ebd5a;
    }

    /* Carousel */
    .carousel {
      position: relative;
      width: 100%;
      height: 300px;
      overflow: hidden;
      border-radius: 16px;
    }

    .carousel img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
    }

    .carousel img.active {
      opacity: 1;
    }

    /* Prezzi */
    .pricing {
      margin-top: 30px;
      text-align: left;
    }

    .pricing h2 {
      text-align: center;
      color: #2c3e50;
    }

    .pricing p {
      font-size: 16px;
      color: #444;
      line-height: 1.6;
    }

    .paypal {
      margin-top: 25px;
      text-align: center;
    }

    .booking-form {
      margin-top: 20px;
    }

    select {
      padding: 8px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    #total {
      margin-top: 10px;
      font-weight: bold;
      color: #2c3e50;
    }

    #google_translate_element {
      position: absolute;
      top: 10px;
      right: 20px;
    }
  </style>
</head>

<body>
  <div id="google_translate_element"></div>

  <div class="container">
    <!-- Carousel -->
    <div class="carousel">
      <img src="foto1.webp" class="active" alt="Appartamento Casa Luigi" />
      <img src="foto2.avif" alt="Camera" />
      <img src="foto3.avif" alt="Cucina" />
      <img src="foto4.avif" alt="Terrazza" />
    </div>

    <h1>Prenota il tuo soggiorno</h1>
    <p>Seleziona le date disponibili nel calendario e invia la tua richiesta direttamente su WhatsApp.</p>

    <div id="calendar"></div>

    <div class="booking-form">
      <label for="guests">Numero di ospiti:</label>
      <select id="guests">
        <option value="1">1 persona</option>
        <option value="2">2 persone</option>
        <option value="3">3 persone</option>
        <option value="4">4 persone</option>
      </select>
      <div id="total"></div>
    </div>

    <a id="whatsappBtn" class="button" target="_blank">Invia richiesta su WhatsApp</a>

    <div class="pricing">
      <h2>Tariffe Stagionali</h2>
      <p>
        üí∞ <strong>Prezzi attuali:</strong><br />
        ‚Ä¢ 1 persona: <strong>‚Ç¨75</strong> a notte<br />
        ‚Ä¢ 2 persone: <strong>‚Ç¨87</strong> a notte<br />
        ‚Ä¢ 3-4 persone: <strong>‚Ç¨110</strong> a notte<br /><br />
        ‚è≥ <strong>Soggiorno minimo:</strong> 2 notti<br />
        üí∏ <strong>Sconti:</strong><br />
        ‚Ä¢ -13% per soggiorni di almeno 7 notti<br />
        ‚Ä¢ -43% per soggiorni di almeno 1 mese<br /><br />
        üìú Per affitti superiori a un mese √® richiesto un contratto conforme al
        <em>canone concordato</em>, in base alla durata e ai requisiti previsti dalla normativa vigente.
      </p>
    </div>

    <div class="paypal">
      <h2>Paga con PayPal</h2>
      <p>Effettua un pagamento sicuro per confermare la tua prenotazione.</p>
      <div id="paypal-button-container"></div>
    </div>
  </div>

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.min.js"></script>

  <!-- PayPal JS -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=EUR"></script>

  <script>
    const phone = "393382661198";
    let selectedDates = [];
    let totalAmount = 0;

    document.addEventListener("DOMContentLoaded", function () {
      const calendarEl = document.getElementById("calendar");
      const today = new Date().toISOString().split("T")[0];

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        selectable: true,
        selectMirror: true,
        locale: "it",
        validRange: { start: today },
        select: function (info) {
          const checkin = new Date(info.startStr);
          const checkout = new Date(info.endStr);
          const nights = (checkout - checkin) / (1000 * 60 * 60 * 24);

          if (nights < 2) {
            alert("Il soggiorno minimo √® di 2 notti.");
            return;
          }

          selectedDates = [info.startStr, info.endStr];
          calculateTotal();
        },
      });

      calendar.render();
    });

    document.getElementById("guests").addEventListener("change", calculateTotal);

    function calculateTotal() {
      if (selectedDates.length === 0) return;

      const guests = parseInt(document.getElementById("guests").value);
      const checkin = new Date(selectedDates[0]);
      const checkout = new Date(selectedDates[1]);
      const nights = (checkout - checkin) / (1000 * 60 * 60 * 24);

      let nightlyRate =
        guests === 1 ? 75 : guests === 2 ? 87 : 110;

      totalAmount = nightlyRate * nights;

      // sconti
      if (nights >= 30) totalAmount *= 0.57;
      else if (nights >= 7) totalAmount *= 0.87;

      document.getElementById("total").textContent =
        `Totale soggiorno: ‚Ç¨${totalAmount.toFixed(2)} (${nights} notti)`;
    }

    document.getElementById("whatsappBtn").addEventListener("click", function () {
      if (selectedDates.length === 0) {
        alert("Seleziona prima le date nel calendario.");
        return;
      }

      const [checkin, checkout] = selectedDates;
      const guests = document.getElementById("guests").value;
      const message = `Ciao Luigi, vorrei prenotare dal ${checkin} al ${checkout} per ${guests} persone. Totale stimato: ‚Ç¨${totalAmount.toFixed(2)}.`;
      const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");
    });

    // Carousel
    const images = document.querySelectorAll(".carousel img");
    let currentIndex = 0;
    setInterval(() => {
      images[currentIndex].classList.remove("active");
      currentIndex = (currentIndex + 1) % images.length;
      images[currentIndex].classList.add("active");
    }, 4000);

    // PayPal
    paypal.Buttons({
      style: { color: "gold", shape: "pill", label: "paypal" },
      createOrder: (data, actions) => {
        if (totalAmount <= 0) {
          alert("Seleziona le date e il numero di ospiti prima di procedere al pagamento.");
          return;
        }
        return actions.order.create({
          purchase_units: [{ amount: { value: totalAmount.toFixed(2) } }],
        });
      },
      onApprove: (data, actions) => {
        return actions.order.capture().then(() => {
          alert("Pagamento completato con successo!");
        });
      },
    }).render("#paypal-button-container");
  </script>
</body>
</html>
